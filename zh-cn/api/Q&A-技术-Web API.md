##调用接口传入信息有没有加密校验？
有的。

**签名算法**

采用应用层签名机制。将HTTP请求body部分的UTF-8编码字节流视为被签名的内容，不关心主体的格式。

签名人序列号（sn）和签名值（sign）放在HTTP请求头中，在接入服务中统一校验。

签名算法: sign = MD5( CONCAT( body + key ) )

签名首部: Authorization: sn + " " + sign

**签名所用的sn和key**

激活接口（/terminal/activate）的签名使用服务商序列号（vendor_sn）和（vendor_key）

其他接口均使用激活接口成功返回的终端号（terminal_sn）和终端密钥（terminal_key）

##签到后secret丢失怎么办？
若因网络或其他原因未收到签到响应，可使用旧密钥再次发起签到请求。

极特殊情况下，两次签到均未收到响应，请联系客服处理。

##何时发起轮询

1. pay接口何时发起轮询：如果pay同步返回的order_status不是[最终状态](#status)，就需要马上发起轮询。轮询时间可以在3~5s，总时长控制在40~50s左右。

	pay接口返回：biz_response.result_code是指一个动作的状态。biz_response.data罗列订单信息，biz_response.data.order_status是指订单状态。


2. precreate接口何时发起轮询：

	Web API接入：在得到预下单成功的结果后，即可向收钱吧服务器发起轮询请求。
	
		预下单成功:biz_response.result_code="PRECREATE_SUCCESS" or biz_response.data.order_status="CREATED")
		
		收钱吧目前所有预下单的订单有效支付时长约为90秒，若超时仍未支付，收钱吧会自动取消该订单；因此轮询时间请控制在100-120秒左右。
		
		轮询的间隔建议为前30秒内2秒一次，之后5秒一次。
	
	SDK接入：如果是有UI模式，SDK会查询预支付结果，不需要额外写程序查询，如果是无UI模式，则需要轮询支付结果。


		C扫B模式生成的二维码有两种：
		第一种是没有有效期的。长期使用的二维码可以用wap支付实现
		第二种是有有效期的。precreate接口生成的二维码的有效期：4min
	
		
##哪些状态是订单最终状态<a name="status"></a>
- PAID
- PAY_CANCELED
- REFUNDED
- PARTIAL_REFUNDED
- CANCELED



##何时调用撤单接口(cancel)？
客户端发起支付请求以后没有收到结果或订单不是最终状态，且在有效时间内也轮询订单依然不是最终状态，则发起自动撤单。该动作类似于POS机的冲正。

##每次支付失败都需要调用撤单接口(cancel)吗？
只有在规定时间内轮询得到的订单状态不为最终状态才需要自动冲正。

##C扫B的模式，二维码可以不依赖终端生成吗？
可以。可采用`系统对接`方式实现。

##系统对接
在商户没有终端的情况下，直接在服务器管理终端号和终端密钥。商户前端只与商户后端通信，后端服务器发现是某个前端的支付请求，就将这笔交易对应到收钱吧的终端，利用这个终断的terminal_sn和terminal_key向收钱吧服务端发起请求。

收钱吧所有交易都需要终端号和终端密钥。开发者可以选择所有支付都算作一个终端发起的请求，也可以采用“前端1->收钱吧终端1，前端2->收钱吧终端2”的方式。后者的好处在于便于商户日后在`商户系统`中对账。

