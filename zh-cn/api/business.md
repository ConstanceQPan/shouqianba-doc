# 业务流程

正常使用支付平台的交易功能，至少需要经历如下三个步骤：

1. 激活(一次)
2. 签到(可选)
3. 交易


## 激活

激活接口用于通过终端激活码（code）来获取终端号（terminal_sn）和终端密钥（terminal_key），以用于调用其他接口时的签名。

激活接口对于同一台终端，只需要调用一次。

![](../img/NotActivited.png?raw=true) 

## 签到

签到接口用于更新终端密钥（terminal_key）。出于安全考虑，开发者可以自行决定何时调用签到接口。终端密钥（terminal_key）一旦更新，旧密钥将会失效。

![](../img/Activited.png?raw=true) 

## 交易
支付平台提供如下类的交易功能：

* **支付**： B扫C支付模式，支付平台会自动根据支付码识别支付方式。

* **退款**： 根据支付平台订单号完成退款，可支持同一笔订单分多次退款。

* **撤单**： 当天的订单可以通过这个接口撤销。和退款接口相比，调用撤单接口在实现全额退款的同时不会向商户加收手续费。

* **查询**： 获取订单的最新状态。

* **二维码预下单**： C扫B当面付模式，调用接口生成二维码，消费者扫码完成支付，接口返回的是二维码内容，开发者需要自己生成二维码图片。


### 主要交易功能时序

#### 支付

![](../img/pay_sd.jpg?raw=true) 

#### 二维码预下单

![](../img/precreate_sd.jpg?raw=true) 

#### 退款

![](../img/refund_sd.jpg?raw=true) 
